!function(e){function t(e,t){var n,a,i=t||{},r=!1,s=i.bufferLen||4096;this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,s,2,2),a=new Worker(i.workerPath||o);var c=i.mp3LibPath||"lame.all.js",d=i.vorbisLibPath||"libvorbis.module.min.js";a.onmessage=function(e){var t=e.data;n(t)},a.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,mp3LibPath:c,vorbisLibPath:d,recordAsMP3:i.recordAsMP3||!1,recordAsOGG:i.recordAsOGG||!1}}),this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])},this.record=function(){r=!0},this.stop=function(){r=!1},this.clear=function(){a.postMessage({command:"clear"})},this.getBuffer=function(e){n=e||i.callback,a.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(n=e||i.callback,t=t||i.type||"audio/wav",!n)throw new Error("Callback not set");a.postMessage({command:"exportWAV",type:t})},this.exportOGG=function(e){n=e||i.callback,a.postMessage({command:"exportOGG"})},this.exportMP3=function(e){n=e||i.callback,a.postMessage({command:"exportMP3"})},this.node.onaudioprocess=function(e){r&&a.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0)]})},e.connect(this.node),this.node.connect(this.context.destination)}var o="js/recorderWorker.js",n={fromSource:function(e,o){return new t(e,o)},requestDevice:function(o,n){n=n||{},o=o||function(){},e.AudioContext=e.AudioContext||e.webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,e.URL=e.URL||e.webkitURL,audio_context=new AudioContext,navigator.getUserMedia({audio:!0},function(e){o(new t(audio_context.createMediaStreamSource(e),n))},function(e){o(null)})}};e.audioRecorder=n}(window);
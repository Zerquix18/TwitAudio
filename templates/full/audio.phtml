<?php
/**
* Template for audio pages
* The variable $template comes
* from the AudioController
*
**/
use \application\View;
View::set_page('audio');

$audio   = $template['audio'];
$user  	 = $audio['user'];
$replies = $template['replies'];
$linked  = $template['linked'];

$title = $user['user'] . ': ';
$description_len = strlen( $audio['description'] );
if( 0 == $description_len )
	$title = sprintf("%s's audio", $user['user']);
elseif( $description_len > 10 )
	$title .= substr($audio['description'], 0, 10) . '...';
elseif( $description_len < 10 )
	$title .= $audio['description'];
View::load_template('header', array(
		'title'		=> $title,
		'robots'	=> $user['audios_public']
	)
);
?>
<div class="content main">
	<div class="row">
		<div class="col l9 m12 s12">
			<div class="box">
				<?php
				View::display_audio($audio, array('size' => 'big') )
				?>
				<div class="share_buttons">
					<script type="text/javascript" async src="https://platform.twitter.com/widgets.js"></script>
					<a
					class="twitter-share-button"
					data-size="large"
					href="https://twitter.com/intent/tweet?<?php
echo http_build_query( array(
			'text' => sprintf(
					__("Listen to @%s's audio"),
					$user['user']
					),
			'via' => 'twit_audio',
			'related' => 'twit_audio,zerquix18,superjd10_,chusen'
			)
		)
					?>">
					<i class="fa fa-twitter"></i>&nbsp;
						Tweet
					</a>
				</div>
				<hr>
				<p class="title">
					<?php _e('Replies') ?>
				</p>
		<?php if( is_logged() ): ?>
				<form method="POST"
				id="form_reply"
				action="<?php
				echo url() . 'ajax/post/reply'
				?>">
				<input type="hidden" name="id" value="<?php echo $audio['id'] ?>">
					<div class="input-field">
   						<textarea class="materialize-textarea" name="reply" maxlength="200" id="reply_box" maxlength="200" required="required"></textarea>
						<label id="label_reply">
						<i class="fa fa-pencil"></i>
					&nbsp;<?php _e('Write a reply') ?>
						</label>
					</div>
					<div class="reply-options">
						<input type="hidden" name="s_twitter" value="0">
						<input checked="checked" type="checkbox" id="twsent" name="s_twitter" value="1">
						<label for="twsent">
					<?php _e('Send to Twitter') ?>
						</label>
						<button type="submit" class="btn right waves-effect waves-light">
					<?php _e('Reply') ?>&nbsp;
						<i class="fa fa-send"></i>
						</button>
					</div>
				</form>
		<?php else: ?>
			<a
			title="<?php _e('You must be logged in to leave a reply') ?>"
			href="<?php
			echo url() . 'signin?back_to=' .
			urlencode( url() . substr($_SERVER['REQUEST_URI'], 1) )
			?>"
			>
				<img
				class="signin"
				src="<?php View::load_img('signin.png') ?>">
			</a>
		<?php endif ?>
			<div class="divider"></div>
				<div id="replies">
			<?php
				if( empty($replies) )
					View::alert_info(
						__("There are not replies yet... Be the first!")
					);
				else {
					while( list(,$reply) = each($replies['audios']) )
						View::display_audio( $reply );
					if( $replies['load_more'] )
						View::load_more('replies', 2);
				}
			?>
				</div>
			</div>
		</div>
		<div class="col l3 m12 s12">
			<?php View::load_template('sidebar') ?>
		</div>
	</div>
</div>
<script type="text/javascript">
var audio_id = '<?php echo $audio['id'] ?>',
	linked   = "<?php if( ! empty($linked) ) echo $linked ?>";
</script>
<?php View::load_template('footer');